services:
  zookeeper:
    image: confluentinc/cp-zookeeper:7.6.1
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    ports:
      - "2181:2181"

  kafka:
    image: confluentinc/cp-kafka:7.6.1
    depends_on:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
    ports:
      - "29092:29092"

  pagi-event-router:
    build:
      context: .
      dockerfile: docker/Dockerfile.service
      args:
        SERVICE: pagi-event-router
    environment:
      - RUST_LOG=info
      - BIND_ADDR=0.0.0.0:8000
      - KAFKA_BROKERS=kafka:9092
    ports:
      - "8000:8000"
    depends_on:
      - kafka

  pagi-external-gateway:
    build:
      context: .
      dockerfile: docker/Dockerfile.service
      args:
        SERVICE: pagi-external-gateway
    environment:
      - RUST_LOG=info
      - BIND_ADDR=0.0.0.0:8010
    ports:
      - "8010:8010"
    depends_on:
      - kafka

  pagi-working-memory:
    build:
      context: .
      dockerfile: docker/Dockerfile.service
      args:
        SERVICE: pagi-working-memory
    environment:
      - RUST_LOG=info
      - BIND_ADDR=0.0.0.0:8003
      - EVENT_ROUTER_URL=http://pagi-event-router:8000
    ports:
      - "8003:8003"
    depends_on:
      - pagi-event-router

  pagi-context-builder:
    build:
      context: .
      dockerfile: docker/Dockerfile.service
      args:
        SERVICE: pagi-context-builder
    environment:
      - RUST_LOG=info
      - BIND_ADDR=0.0.0.0:8004
      - WORKING_MEMORY_URL=http://pagi-working-memory:8003
      - EVENT_ROUTER_URL=http://pagi-event-router:8000
    ports:
      - "8004:8004"
    depends_on:
      - pagi-event-router
      - pagi-working-memory

  pagi-inference-gateway:
    build:
      context: .
      dockerfile: docker/Dockerfile.service
      args:
        SERVICE: pagi-inference-gateway
    environment:
      - RUST_LOG=info
      - BIND_ADDR=0.0.0.0:8005
      - EVENT_ROUTER_URL=http://pagi-event-router:8000
    ports:
      - "8005:8005"
    depends_on:
      - pagi-event-router

  pagi-identity-service:
    build:
      context: .
      dockerfile: docker/Dockerfile.service
      args:
        SERVICE: pagi-identity-service
    environment:
      - RUST_LOG=info
      - BIND_ADDR=0.0.0.0:8002
      - EVENT_ROUTER_URL=http://pagi-event-router:8000
    ports:
      - "8002:8002"
    depends_on:
      - pagi-event-router

  pagi-executive-engine:
    build:
      context: .
      dockerfile: docker/Dockerfile.service
      args:
        SERVICE: pagi-executive-engine
    environment:
      - RUST_LOG=info
      - BIND_ADDR=0.0.0.0:8006
      - EVENT_ROUTER_URL=http://pagi-event-router:8000
      - CONTEXT_BUILDER_URL=http://pagi-context-builder:8004
      - INFERENCE_GATEWAY_URL=http://pagi-inference-gateway:8005
      - EMOTION_STATE_URL=http://pagi-emotion-state-manager:8007
      - SENSOR_ACTUATOR_URL=http://pagi-sensor-actuator:8008
      - EXTERNAL_GATEWAY_URL=http://pagi-external-gateway:8010
    ports:
      - "8006:8006"
    depends_on:
      - pagi-event-router
      - pagi-context-builder
      - pagi-inference-gateway
      - pagi-emotion-state-manager
      - pagi-sensor-actuator
      - pagi-external-gateway

  pagi-emotion-state-manager:
    build:
      context: .
      dockerfile: docker/Dockerfile.service
      args:
        SERVICE: pagi-emotion-state-manager
    environment:
      - RUST_LOG=info
      - BIND_ADDR=0.0.0.0:8007
      - EVENT_ROUTER_URL=http://pagi-event-router:8000
    ports:
      - "8007:8007"
    depends_on:
      - pagi-event-router

  pagi-sensor-actuator:
    build:
      context: .
      dockerfile: docker/Dockerfile.service
      args:
        SERVICE: pagi-sensor-actuator
    environment:
      - RUST_LOG=info
      - BIND_ADDR=0.0.0.0:8008
      - EVENT_ROUTER_URL=http://pagi-event-router:8000
    ports:
      - "8008:8008"
    depends_on:
      - pagi-event-router
